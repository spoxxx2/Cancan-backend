nc(LOG_DIR)) fs.mkdirSync(LOG_DIR);
if (!fs.existsSync(IMAGE_DIR)) fs.mkdirSync(IMAGE_DIR);

console.log("ðŸ’šâš¡ CANCAN HQ â€” Neon Pulse Backend v4.2 ACTIVE");
console.log("ðŸ’šâš¡ Listening on port 3000");

// ====================================================
//  RECEIVE FIELD LOGS
// ====================================================

app.post("/api/cancan", (req, res) => {
    const data = req.body;

    if (!data.filename) {
        return res.status(400).json({ error: "Missing filename" });
    }

    const logEntry = {
        timestamp: data.timestamp,
        filename: data.filename,
        unit: data.unit,
        caption: data.caption || "",
        hash: data.hash,
        version: "cancan",
        signature: "Turning trash into town aid",
        mood: "steady",
        received_at: Date.now()
    };

    const logPath = path.join(LOG_DIR, `${data.timestamp}.json`);
    fs.writeFileSync(logPath, JSON.stringify(logEntry, null, 2));

    res.json({ status: "ok" });
});

// ====================================================
//  RETURN ALL LOGS
// ====================================================

app.get("/api/logs", (req, res) => {
    const files = fs.readdirSync(LOG_DIR)
        .filter(f => f.endsWith(".json"))
        .map(f => {
            const raw = fs.readFileSync(path.join(LOG_DIR, f));
            return JSON.parse(raw);
        });

    res.json(files);
});

// ====================================================
//  SERVE IMAGES
// ====================================================

app.use("/images", express.static(IMAGE_DIR));

// ====================================================
//  START SERVER
// ====================================================

app.listen(3000);
